import asyncio
from typing import Literal, Dict, Any

import aiohttp
import execjs

import Service


class WenCaiService():
    wencaiJSCode = execjs.compile(str(
        b'var TOKEN_SERVER_TIME = 1572845499.629;\nfunction v_cookie (r, n, t, e, a) {\n    var u = n[0],\n        c = n[1],\n        v = a[0],\n        s = t[0],\n        f = t[1],\n        l = r[0],\n        d = hr(a[1], e[0], t[2]),\n        p = t[3],\n        h = e[1],\n        g = yr(a[2], a[3], e[2]),\n        m = yr(a[4], r[1], t[4]),\n        w = r[2],\n        I = a[5],\n        _ = a[6],\n        y = a[7],\n        E = hr(n[2], r[3], r[4]),\n        A = t[5],\n        C = e[3],\n        b = e[4],\n        B = t[6],\n        R = a[8],\n        T = a[9],\n        S = n[3],\n        k = t[7],\n        x = t[8],\n        O = a[10],\n        L = n[4],\n        M = n[5],\n        N = a[11],\n        P = e[5],\n        j = hr(n[6], e[6], t[9], r[5]),\n        D = t[10],\n        W = e[7],\n        $ = r[6],\n        F = yr(r[7], t[11], e[8], n[7]),\n        X = r[8],\n        H = t[12],\n        K = r[9],\n        U = n[8],\n        V = e[9],\n        Y = r[10],\n        J = e[10],\n        q = r[11],\n        Q = a[12],\n        Z = n[9],\n        G = t[13],\n        z = t[14],\n        rr = t[15],\n        nr = n[10],\n        tr = a[13],\n        er = a[14],\n        ar = e[11],\n        or = r[12],\n        ir = yr(t[16], r[13], r[14], r[15]),\n        ur = t[17],\n        cr = t[18];\n    function vr () {\n        var r = arguments[n[11]];\n        return r.split(n[12]).reverse().join(e[12])\n    }\n    var sr = [new e[13](hr(a[15], n[13], a[16])), new e[13](a[17])];\n    function fr () {\n        var n = arguments[a[18]];\n        if (!n) return a[19];\n        for (var o = t[19], i = e[14], u = e[15]; u < n.length; u++)\n        {\n            var c = n.charCodeAt(u),\n                v = c ^ i;\n            i = c,\n                o += r[16].fromCharCode(v)\n        }\n        return o\n    }\n    var lr = \'\',\n        dr; !\n            function (o) {\n                var i = e[18],\n                    c = e[19];\n                o[e[20]] = a[21];\n                function v (t, a, o, i, u) {\n                    var c, v, s;\n                    c = v = s = r;\n                    var f, l, d;\n                    f = l = d = n;\n                    var p, h, g;\n                    p = h = g = e;\n                    var m = t + g[21] + a;\n                    i && (m += l[15] + i),\n                        u && (m += h[22] + u),\n                        o && (m += v[17] + o),\n                        l[14][g[23]] = m\n                }\n                o[e[24]] = l;\n                function s (t, e, a) {\n                    var o = n[16];\n                    this.setCookie(t, r[18], i + o + c, e, a)\n                }\n                o[t[22]] = f;\n                function f (o) {\n                    var i = vr(e[25], a[22]),\n                        c = a[23][n[17]],\n                        v = u + i + o + t[23],\n                        s = \'\';\n                    if (s == -r[19])\n                    {\n                        if (v = o + t[23], c.substr(a[24], v.length) != v) return;\n                        s = a[24]\n                    }\n                    var f = s + v[r[20]],\n                        l = \'\';\n                    return l == -e[26] && (l = c[t[24]])\n\n                }\n                o[e[27]] = v;\n                function l () {\n                    var r, t, a;\n                    r = t = a = e;\n                    var i, u, c;\n                    i = u = c = n;\n                    var v = u[18];\n                    this.setCookie(v, a[28]),\n                        this.getCookie(v) || (o[i[19]] = u[20]),\n                        this.delCookie(v)\n                }\n                o[n[21]] = s\n            }(dr || (dr = {}));\n    var pr;\n    function hr () {\n        var r = arguments[a[25]];\n        if (!r) return a[19];\n        for (var e = a[19], o = t[25], i = n[22], u = t[18]; u < r.length; u++)\n        {\n            var c = r.charCodeAt(u);\n            i = (i + t[26]) % o.length,\n                c ^= o.charCodeAt(i),\n                e += String.fromCharCode(c)\n        }\n        return e\n    } !\n        function (o) {\n            var i, u, d;\n            i = u = d = a;\n            var p, h, g;\n            p = h = g = t;\n            var m, w, I;\n            m = w = I = r;\n            var _, y, E;\n            _ = y = E = n;\n            var b, B, R;\n            b = B = R = e;\n            var T = B[29],\n                S = y[23],\n                k = m[22],\n                x = w[0],\n                O = E[24],\n                L = (C, Ar, R[30]),\n                M = b[31],\n                N = T + S,\n                P = p[28],\n                j,\n                W = m[23][y[25]],\n                $,\n                F;\n            function X (r) {\n                return function () {\n                    F.appendChild(j),\n                        j.addBehavior(u[26]),\n                        j.load(N);\n                    var n = r();\n                    return F.removeChild(j),\n                        n\n                }\n            }\n            function H () {\n                var r = A;\n                r = D;\n                try\n                {\n                    return !!(N in B[32] && b[32][N])\n                } catch (n)\n                {\n                    return void B[15]\n                }\n            }\n            function K (r) {\n                return P ? G(r) : j ? Y(r) : void _[26]\n            }\n            function U () {\n                if (P = H(), P) j = _[27][N];\n                else if (W[k + c][I[24]]) try\n                {\n                    $ = new ActiveXObject(vr(I[25], y[28], w[26])),\n                        $.open(),\n                        $.write(y[29]),\n                        $.close(),\n                        F = $.w[B[33]][I[27]][_[30]],\n                        j = F.createElement(I[28])\n                } catch (r)\n                {\n                    j = W.createElement(N),\n                        F = W[vr(I[29], d[27])] || W.getElementsByTagName(b[17])[I[27]] || W[m[30]]\n                }\n            }\n            o[w[31]] = U;\n            function V (r, n) {\n                var t = J;\n                if (void 0 === n) return Z(r);\n                if (t = sr, P) z(r, n);\n                else\n                {\n                    if (!j) return void B[15];\n                    Q(r, n)\n                }\n            }\n            o[v + x] = V;\n            function Y (r) {\n                X(function () {\n                    return r = J(r),\n                        j.getAttribute(r)\n                })()\n            }\n            function J (r) {\n                var n = z;\n                n = v;\n                var t = vr(Ir, w[32]),\n                    e = new y[31](t + O + s + L, b[31]);\n                return r.replace(new B[13](d[28]), b[34]).replace(e, p[29])\n            }\n            function q (r) {\n                try\n                {\n                    j.removeItem(r)\n                } catch (n) { }\n            }\n            o[M + f + l] = K;\n            function Q (r, n) {\n                var t = G;\n                t = cr,\n                    X(function () {\n                        var t = M;\n                        r = J(r),\n                            t = K;\n                        try\n                        {\n                            j.setAttribute(r, n),\n                                j.save(N)\n                        } catch (e) { }\n                    })()\n            }\n            function Z (r) {\n                var n, t, e;\n                if (n = t = e = g, P) q(r);\n                else\n                {\n                    if (!j) return void t[18];\n                    rr(r)\n                }\n            }\n            function G (r) {\n                try\n                {\n                    return j.getItem(r)\n                } catch (n)\n                {\n                    return y[20]\n                }\n            }\n            o[fr(w[33], p[30], R[35])] = Z;\n            function z (r, n) {\n                try\n                {\n                    j.setItem(r, n)\n                } catch (t) { }\n            }\n            function rr (r) {\n                X(function () {\n                    r = J(r),\n                        j.removeAttribute(r),\n                        j.save(N)\n                })()\n            }\n        }(pr || (pr = {}));\n    var gr = function () {\n        var o, i, u;\n        o = i = u = e;\n        var c, v, s;\n        c = v = s = a;\n        var f, l, g;\n        f = l = g = n;\n        var m, w, I;\n        m = w = I = t;\n        var _, E, A;\n        _ = E = A = r;\n        var C = yr(Cr, U, _[34]),\n            b = vr(A[35], m[31]),\n            R = hr(g[32], c[29], i[36]),\n            T = hr(l[33], g[34], i[37], tr);\n        function S (r) {\n            this[m[32]] = r;\n            for (var n = o[15], t = r[i[38]]; t > n; n++) this[n] = i[15]\n        }\n        return S[d + p + C][b + h] = function () {\n            for (var r = this[vr(h, E[36], E[37])], n = [], t = -I[26], e = o[15], a = r[A[20]]; a > e; e++) for (var u = this[e], f = r[e], d = t += f; n[d] = u & parseInt(v[30], l[35]), --f != s[24];)--d,\n                u >>= parseInt(i[39], c[31]);\n            return n\n        },\n            S[vr(w[33], v[32])][_[38]] = function (r) {\n                var n = dr,\n                    t = this[vr(y, l[36], A[39])],\n                    e = f[26];\n                n = B;\n                for (var a = v[24], o = t[l[37]]; o > a; a++)\n                {\n                    var i = t[a],\n                        u = l[26];\n                    do u = (u << parseInt(R + T, g[35])) + r[e++];\n                    while (--i > w[18]);\n                    this[a] = u >>> w[18]\n                }\n            },\n            S\n    }(),\n        mr; !\n            function (o) {\n                var i, u, c;\n                i = u = c = n;\n                var v, s, f;\n                v = s = f = e;\n                var l, d, p;\n                l = d = p = a;\n                var h, w, I;\n                h = w = I = r;\n                var _, y, E;\n                _ = y = E = t;\n                var A = y[34],\n                    C = (nr, U, h[40]),\n                    b = p[25];\n                function B (r) {\n                    for (var n = y[35], t = f[15], e = r[vr(c[38], I[41], H)], a = []; e > t;)\n                    {\n                        var o = k[r.charAt(t++)] << parseInt(g + A, d[31]) | k[r.charAt(t++)] << parseInt(n + m, h[42]) | k[r.charAt(t++)] << parseInt(I[43], i[35]) | k[r.charAt(t++)];\n                        a.push(o >> parseInt(_[36], h[42]), o >> l[31] & parseInt(u[39], i[40]), o & parseInt(d[30], c[35]))\n                    }\n                    return a\n                }\n                function T (r) {\n                    for (var n = (O, R, p[24]), t = I[27], e = r[E[24]]; e > t; t++) n = (n << E[37]) - n + r[t];\n                    return n & parseInt(E[38], p[33])\n                }\n                for (var S = s[40], k = {},\n                    x = s[15]; x < parseInt(I[44], l[34]); x++) k[S.charAt(x)] = x;\n                function L (r) {\n                    var n = B(r),\n                        t = n[u[26]];\n                    if (t != b) return error = yr(V, u[41], s[41], v[42]),\n                        void 0;\n                    var e = n[s[26]],\n                        a = [];\n                    return P(n, +_[39], a, +_[18], e),\n                        T(a) == e ? a : void 0\n                }\n                function M (r) {\n                    var n = T(r),\n                        t = [b, n];\n                    return P(r, +l[24], t, +p[25], n),\n                        N(t)\n                }\n                function N (r) {\n                    var n, t, e;\n                    n = t = e = f;\n                    var a, o, u;\n                    a = o = u = y;\n                    var c, v, s;\n                    c = v = s = h;\n                    var d, p, g;\n                    d = p = g = l;\n                    var m, w, I;\n                    m = w = I = i;\n                    for (var _ = m[42], E = d[24], A = r[c[20]], b = []; A > E;)\n                    {\n                        var B = r[E++] << parseInt(fr(Z, d[35]), o[39]) | r[E++] << g[31] | r[E++];\n                        b.push(S.charAt(B >> parseInt(m[43], t[43])), S.charAt(B >> parseInt(p[36], o[40]) & parseInt(I[44], I[45])), S.charAt(B >> n[44] & parseInt(_ + C, n[42])), S.charAt(B & parseInt(fr(d[37], c[45], or), a[41])))\n                    }\n                    return b.join(o[19])\n                }\n                function P (r, n, t, e, a) {\n                    var o, i, u;\n                    o = i = u = w;\n                    var c, v, s;\n                    c = v = s = E;\n                    for (var f = r[v[24]]; f > n;) t[e++] = r[n++] ^ a & parseInt(u[46], s[42]),\n                        a = ~(a * parseInt(v[43], v[40]))\n                }\n                o[E[44]] = N,\n                    o[_[45]] = B,\n                    o[v[45]] = M,\n                    o[y[46]] = L\n            }(mr || (mr = {}));\n    var wr; !\n        function (o) {\n            var i = a[38],\n                u = r[47],\n                c = t[47],\n                v = vr(n[46], a[39], a[40]),\n                s = e[46],\n                f = e[47],\n                l = a[41],\n                d = a[42];\n            function p (o) {\n                var i = a[43],\n                    u = vr(n[47], e[48], n[48]),\n                    c = {},\n                    v = function (o, c) {\n                        var s, f, l, d;\n                        for (c = c.replace(n[49], n[12]), c = c.substring(e[26], c[e[38]] - e[26]), s = c.split(e[49]), l = a[24]; l < s[yr(v, sr, t[48])]; l++) if (f = s[l].split(n[50]), f && !(f[a[44]] < t[39]))\n                        {\n                            for (d = n[35]; d < f[r[20]]; d++) f[n[11]] = f[n[11]] + r[48] + f[d];\n                            f[n[26]] = new a[45](r[49]).test(f[n[26]]) ? f[e[15]].substring(r[19], f[e[15]][a[44]] - n[11]) : f[n[26]],\n                                f[n[11]] = new r[50](i + u + w).test(f[n[11]]) ? f[e[26]].substring(t[26], f[r[19]][n[37]] - t[26]) : f[a[18]],\n                                o[f[r[27]]] = f[n[11]]\n                        }\n                        return o\n                    };\n                return new a[45](I + _).test(o) && (c = v(c, o)),\n                    c\n            }\n            function h (n) {\n                for (var t = [], e = a[24]; e < n[r[20]]; e++) t.push(n.charCodeAt(e));\n                return t\n            }\n            function g (o) {\n                var u = a[46];\n                if (typeof o === vr(O, a[47], or) && o[a[48]]) try\n                {\n                    var c = parseInt(o[a[48]]);\n                    switch (c)\n                    {\n                        case parseInt(i + u, t[42]): break;\n                        case parseInt(yr(t[49], r[51], e[50]), e[43]): top[t[50]][n[51]] = o[e[51]];\n                            break;\n                        case parseInt(yr(a[25], j, e[52]), n[52]): top[n[53]][t[51]] = o[t[52]]\n                    }\n                } catch (v) { }\n            }\n            function m (r, n, t) {\n\n            }\n            function L () {\n                var e, a, o;\n                e = a = o = r;\n                var i, u, c;\n                i = u = c = n;\n                var v, s, f;\n                v = s = f = t;\n                var l = f[53],\n                    d = c[54],\n                    p = new e[52];\n                return typeof TOKEN_SERVER_TIME == y + l + d ? s[18] : (time = parseInt(TOKEN_SERVER_TIME), time)\n            }\n            function M () {\n                var o = new t[54];\n                try\n                {\n                    return time = n[2].now(),\n                        time / parseInt(fr(a[50], a[51], r[53]), t[40]) >>> e[15]\n                } catch (i)\n                {\n                    return time = o.getTime(),\n                        time / parseInt(e[53], a[25]) >>> r[27]\n                }\n            }\n            function N (r) {\n                for (var a = t[18], o = r[t[24]] - n[11]; o >= e[15]; o--) a = a << e[26] | +r[o];\n                return a\n            }\n            function P (a) {\n                var o = new r[50](n[55]);\n                if (K(a)) return a;\n                var i = o.test(a) ? -e[54] : -t[39],\n                    u = a.split(r[54]);\n                return u.slice(i).join(fr(n[56], t[55], E))\n            }\n            function j (t) {\n                for (var o = n[26], i = e[15], u = t[vr(r[55], a[52], D)]; u > i; i++) o = (o << r[56]) - o + t.charCodeAt(i),\n                    o >>>= n[26];\n                return o\n            }\n            function W (n, o) {\n                var i = new a[45](t[56], yr(r[57], $, t[57], r[58])),\n                    u = new a[45](t[58]);\n                if (n)\n                {\n                    var c = n.match(i);\n                    if (c)\n                    {\n                        var v = c[e[26]];\n                        return o && u.test(v) && (v = v.split(t[59]).pop().split(r[48])[e[15]]),\n                            v\n                    }\n                }\n            }\n            function $ (o) {\n                var i = n[57],\n                    u = vr(e[55], e[56]),\n                    f = e[4];\n                if (!(o > t[60]))\n                {\n                    o = o || a[24];\n                    var l = parseInt(E + c + A, r[42]),\n                        d = n[14].createElement(e[57]);\n                    d[r[59]] = n[58] + parseInt((new a[53]).getTime() / l) + r[60],\n                        d[r[61]] = function () {\n                            var n = a[46];\n                            cr = r[19],\n                                setTimeout(function () {\n                                    $(++o)\n                                },\n                                    o * parseInt(C + n, a[33]))\n                        },\n                        d[t[61]] = d[hr(a[54], a[55], t[62])] = function () {\n                            var a = n[59];\n                            this[i + v + u + b] && this[e[58]] !== n[60] && this[s + B + a + f] !== e[59] && this[t[63]] !== n[61] || (cr = e[15], d[hr(N, r[62], n[62], e[25])] = d[t[64]] = r[63])\n                        },\n                        e[60][e[61]].appendChild(d)\n                }\n            }\n            function F () {\n                var r = a[56];\n                return Math.random() * parseInt(R + T + f + r, t[42]) >>> n[26]\n            }\n            function X (r) {\n                var e = new n[31](fr(t[65], t[66], a[57]), yr(c, n[63], t[57]));\n                if (r)\n                {\n                    var o = r.match(e);\n                    return o\n                }\n            }\n            o[S + k] = p,\n                o[r[64]] = $,\n                o[t[67]] = g,\n                o[t[68]] = h,\n                o[t[69]] = j,\n                o[t[70]] = F,\n                o[r[65]] = K,\n                o[x + l] = P,\n                o[t[71]] = W,\n                o[t[72]] = X,\n                o[hr(r[66], t[73], r[67], C)] = N,\n                o[t[74]] = M,\n                o[d + O] = L;\n            function K (n) {\n                return new r[50](t[75]).test(n)\n            }\n            o[r[68]] = m\n        }(wr || (wr = {}));\n    var Ir; !\n        function (o) {\n            var i = t[76],\n                u = t[77],\n                c = n[65],\n                v = t[78],\n                s = a[24],\n                f = n[26],\n                l = t[18],\n                d = t[18],\n                p = e[15],\n                h = a[24],\n                g = r[69],\n                m = \'\';\n            wr.eventBind(e[60], n[67], E),\n                wr.eventBind(r[71], t[79], E),\n                wr.eventBind(t[20], hr(e[64], A, a[59]), b),\n                wr.eventBind(e[60], r[72], y);\n            function w () {\n                return f\n            }\n            function I (r) {\n                f++\n            }\n            function _ () {\n                return {\n                    x: p,\n                    y: h,\n                    trusted: g\n                }\n            }\n            function y (r) {\n                d++\n            }\n            function E (r) {\n                s++\n            }\n            function C () {\n                return l\n            }\n            function b (r) {\n                var o, i, u;\n                o = i = u = n;\n                var c, s, f;\n                c = s = f = t;\n                var d, m, w;\n                d = m = w = e;\n                var I, _, y;\n                I = _ = y = a;\n                var E = I[60],\n                    A = d[65];\n                l++ ,\n                    g = void 0 == r[E + A + v] || r[yr(f[80], s[81], i[68])],\n                    p = r[s[82]],\n                    h = r[c[83]]\n            }\n            function B () {\n                return d\n            }\n            function R () {\n                return s\n            }\n            o[r[73]] = R,\n                o[a[61]] = w,\n                o[fr(a[62], n[69])] = C,\n                o[n[70]] = B,\n                o[r[74]] = _\n        }(Ir || (Ir = {}));\n    var _r; !\n        function (u) {\n            var v = fr(n[71], t[84]),\n                s = r[75],\n                f = yr(dr, n[72], e[66], $),\n                l = r[76],\n                d = e[67],\n                p = r[77],\n                h = hr(dr, r[78], a[63], n[73]),\n                g = r[79],\n                m = n[74];\n            BROWSER_LIST = {\n\n            };\n            function w () {\n                var t, e, a;\n                t = e = a = r;\n                var o, i, u;\n                o = i = u = n;\n                return wr.booleanToDecimal(c)\n            }\n            function I (t) {\n                for (var o = n[26]; o < y[e[38]]; o++)\n                {\n                    var i = y[o][r[94]];\n                    if (t.test(i)) return !a[24]\n                }\n                return !a[18]\n            }\n            function E (t) {\n\n            }\n            function A () {\n                return a[73]\n            }\n\n            function B () {\n                return n[20]\n            }\n\n            function T () {\n                return I(new t[93](r[96]))\n            }\n            function S () {\n                return I(new a[45](t[98], r[97]))\n            }\n            function k () {\n                for (var r in BROWSER_LIST) if (BROWSER_LIST.hasOwnProperty(r))\n                {\n                    var n = BROWSER_LIST[r];\n                    if (n()) return + r.substr(a[18])\n                }\n                return e[15]\n            }\n            function x () {\n                var n, a, o;\n                n = a = o = r;\n                var i, u, c;\n                i = u = c = t;\n                var v, s, f;\n                v = s = f = e;\n                var l = s[75],\n                    d = s[76];\n                return I(new u[93](o[98], v[71])) || E(l + F + d + X)\n            }\n            function O () {\n\n            }\n            function L () {\n                var r, n, t;\n                r = n = t = a;\n                var o, i, u;\n                o = i = u = e;\n                var c = l;\n                return c = p\n            }\n            function M () {\n                var r, n, a;\n                r = n = a = t;\n                var o, i, u;\n                o = i = u = e;\n                var c;\n                try\n                {\n                    c = i[60].createElement(a[99]).getContext(i[78])\n                } catch (v) { }\n                return !!c\n            }\n\n\n            function J () {\n                var t, e, o;\n                t = e = o = n;\n                var i, u, c;\n                i = u = c = a;\n                var v, s, f;\n                return v = s = f = r,\n                    -parseInt(s[100], c[31]) === (new e[2]).getTimezoneOffset()\n            }\n\n            function Q () {\n                try\n                {\n                } catch (e)\n                {\n                    return r[101]\n                }\n            }\n            function Z () {\n                var n, a, o;\n                n = a = o = e;\n                var i, u, c;\n                i = u = c = r;\n                var v, s, f;\n                return v = s = f = t,\n                    plugin_num = s[18],\n                    plugin_num\n            }\n            var z = [R, x, S, T, L, Q, b, V, O, J, M, q, Y, B, tr, A];\n\n            var nr = [new e[13](n[85]), new n[31](e[82]), new r[50](e[83]), new r[50](t[102]), new n[31](e[84]), new a[45](a[78]), new a[45](e[85]), new e[13](t[103]), new a[45](r[103]), new t[93](r[104]), new a[45](r[105])];\n            function tr () {\n                return e[86]\n            }\n            u[e[87]] = rr,\n                u[a[79]] = k,\n                u[yr(c, e[88], r[106])] = Z,\n                u[K + U + m] = w\n        }(_r || (_r = {}));\n    function yr () {\n        var o = arguments[a[25]];\n        if (!o) return t[19];\n        for (var i = a[19], u = e[14], c = r[27]; c < o.length; c++)\n        {\n            var v = o.charCodeAt(c),\n                s = v ^ u;\n            u = u * c % a[80] + e[89],\n                i += n[86].fromCharCode(s)\n        }\n        return i\n    }\n    var Er; !\n        function (o) {\n            var i = a[81],\n                u = t[35],\n                c = r[107],\n                v = vr(S, a[56]),\n                f = r[27],\n                l = r[19],\n                d = a[25],\n                p = n[87],\n                h = parseInt(e[90], r[108]),\n                g = a[82],\n                m = parseInt(vr(s, t[104]), t[39]),\n                w = r[109],\n                I = t[40],\n                _ = parseInt(i + V, n[45]),\n                y = parseInt(u + c, n[52]),\n                E = parseInt(t[105], r[42]),\n                A = e[91],\n                C = parseInt(Y + v, r[42]),\n                b = parseInt(e[92], e[93]),\n                B = t[106],\n                R = parseInt(vr(e[94], e[95]), t[41]),\n                T = parseInt(a[83], e[93]),\n                k;\n            function x () {\n                var r = M();\n                return r\n            }\n            function O () {\n                var r = t[26],\n                    a = n[35],\n                    o = e[54],\n                    i = n[88];\n                k = new gr([i, i, i, i, r, r, r, o, a, a, a, a, a, a, a, i, a, r]),\n                    k[l] = wr.serverTimeNow(),\n                    L(),\n                    k[B] = cr,\n                    k[T] = ur,\n                    k[R] = e[15],\n                    k[C] = _r.getBrowserFeature(),\n                    k[g] = _r.getBrowserIndex(),\n                    k[m] = _r.getPluginNum()\n            }\n            function L () {\n                var a = dr.getCookie(tr) || pr.get(ar);\n                if (a && a[r[20]] == parseInt(e[96], n[52]))\n                {\n                    var o = mr.decode(a);\n                    if (o && (k.decodeBuffer(o), k[f] != t[18])) return\n                }\n                k[f] = wr.random()\n            }\n            o[a[84]] = O;\n            function M () {\n                k[R]++ ,\n                    k[l] = wr.serverTimeNow(),\n                    k[d] = wr.timeNow(),\n                    k[B] = cr,\n                    k[w] = Ir.getMouseMove(),\n                    k[I] = Ir.getMouseClick(),\n                    k[_] = Ir.getMouseWhell(),\n                    k[y] = Ir.getKeyDown(),\n                    k[E] = Ir.getClickPos().x,\n                    k[A] = Ir.getClickPos().y;\n                var r = k.toBuffer();\n                return mr.encode(r)\n            }\n            o[yr(r[3], n[89], e[97])] = x\n        }(Er || (Er = {}));\n    var Ar; !\n        function (o) {\n            var i = n[90],\n                u = a[85],\n                v = r[110],\n                s = a[86],\n                f = t[107],\n                p,\n                h,\n                m,\n                w,\n                I,\n                _;\n            function E (r) {\n                return N(r) && dr[a[87]]\n            }\n            function A (o) {\n                var i = wr.getOriginFromUrl(o);\n                return i ? !new n[31](yr(r[42], c, t[110]) + w).test(i[r[108]]) || !new e[13](I).test(i[a[18]]) : t[111]\n            }\n            function C (e) {\n                var o = (_r, g, Er.update());\n                return e + (new r[50](vr(a[88], a[89])).test(e) ? n[91] : vr(P, a[90], t[112])) + er + t[23] + r[111](o)\n            }\n            function b (o, i, u) {\n                if (r[112] in i) return i.apply(o, u);\n                switch (u[n[37]])\n                {\n                    case n[26]:\n                        return i();\n                    case a[18]:\n                        return i(u[n[26]]);\n                    case r[108]:\n                        return i(u[e[15]], u[r[19]]);\n                    default:\n                        return i(u[n[26]], u[r[108]], u[t[17]])\n                }\n            }\n            function B () {\n                var r = Er.update();\n                return r\n            }\n            function k (r, e, o) {\n                if (!r) return n[20];\n                var i = r[e];\n                if (!i) return t[111];\n                var u = o(i);\n                return d || (u[a[97]] = i + t[19]),\n                    u[n[97]] = i,\n                    r[e] = u,\n                    a[21]\n            }\n            function M (o) {\n                var i, u, c;\n                i = u = c = n;\n                var v, s, l;\n                v = s = l = r;\n                var d, p, h;\n                d = p = h = e;\n                var g, m, w;\n                g = m = w = a;\n                var I, _, y;\n                I = _ = y = t;\n                var R = hr(I[121], w[106], d[109]),\n                    T;\n                k(o, _[122],\n                    function (r) {\n                        var n = w[107];\n                        return function () {\n                            var t, e, a;\n                            t = e = a = _;\n                            var o, i, u;\n                            o = i = u = l;\n                            var c, v, s;\n                            c = v = s = w;\n                            var f = s[108];\n                            try\n                            {\n                                A(arguments[s[18]]) && !E(arguments[o[19]]) ? arguments[a[26]] = C(arguments[s[18]]) : T = B(),\n                                    r.apply(this, arguments),\n                                    A(arguments[i[19]]) || this.setRequestHeader(ar, T)\n                            } catch (d)\n                            {\n                                return n + f\n                            }\n                        }\n                    }),\n                    k(o, g[109],\n                        function (r) {\n                            var n = b;\n                            n = M;\n                            var t = vr(_[123], u[107]);\n                            return function () {\n                                var n = fr(f, c[108], I[124]),\n                                    e = s[122];\n                                try\n                                {\n                                    if (parseInt(this.status) === parseInt(h[110], v[123]))\n                                    {\n                                        for (var a = r.apply(this, arguments), o = new p[13](i[109], n + R), u, l, d = {}; u = o.exec(a);) d[u[m[18]].toLowerCase()] = u[v[108]];\n                                        wr.analysisRst(wr.parse(d[ir.toLowerCase()]))\n                                    }\n                                } catch (g)\n                                {\n                                    return e + t\n                                }\n                                return r.apply(this, arguments)\n                            }\n                        })\n            }\n            function N (r) {\n                var n = wr.getHostFromUrl(r, e[28]);\n                return n ? _.test(n) : e[28]\n            }\n            function j () {\n                var cookie_v;\n                cookie_v = B()\n                return cookie_v\n            }\n            o[n[111]] = j\n        }(Ar || (Ar = {}));\n    var Cr;\n    var cookie = (function (a) {\n        function _ () {\n            var cookie_v;\n            Er.Init();\n            cookie_v = Ar.Init();\n            return cookie_v\n        }\n        return function y () {\n            try\n            {\n                return _()\n            } catch (r)\n            {\n                return r\n            }\n        }\n    })()\n    return cookie()\n}\nfunction v () {\n    var v;\n    v = v_cookie(\n        ["t", 34, \'"$\', 36, "\\f\x03b", 55, "ure", "lJ#K", "Flash", "getBro", "1", "analys", "CHAMELEON_CALLBACK", 30, "\\u256f\\u0930\\u097b\\u09ff\\u09a4\\u0934\\u099d\\u09c1\\u099d\\u09d9\\u09a7\\u09c3\\u0995\\u09f0\\u09d3\\u0a62\\u0a6f\\u09bc\\u09ad\\u0934", "F,sp-", String, "; expires=", "", 1, "length", "; ", \'\', \'\', "addBehavior", ";^l", ">*]+", 0, "div", "&\x19~!", "", "Init", "(\'&%$#\\"![", ">NJ", "\\u254e\\u096d\\u095f", "W$R", "sdelif_esab", "Or)E", "decodeBuffer", 84, "f", "htgnel", 8, "110", "40", "\\u2504\\u2562", "255", "o", ":", \'^".*"$\', RegExp, 40, Date, "e9", ".", 19, 5, "t8JOi", "}\x1fB", "src", ".js", "onerror", "\x1e*q:", null, "getServerTime", "isIPAddr", "8-", "ZX9Y]V8aWs3VQZ7Y", "eventBind", !0, "wheel", \'\', "keydown", "getMouseMove", "getClickPos", "vent", "me", "MSG", 41, "th", "safari", "ActiveXObject", "maxHeight", "head", "Google Inc.", "vendor", "sgAppName", "opr", 94, "tu\x14gw`\x05pj", "chrome", "2345Explorer", "ome", "TheWorld", "name", "\\u2553\\u253c\\u2572\\u251d\\u2569\\u253d\\u254f\\u252e\\u254d\\u2526", "Native Client", "i", "Shockwave", "systemLanguage", "740", !1, "plugins", "^ARM", "^iPod", "^BlackBerry", "\\u2550\\u0978\\u094e\\u09c1\\u09bc\\u0928\\u0989\\u09d8\\u099a\\u09f3\\u09b7\\u09dc", "0", 2, 7, "c", encodeURIComponent, "apply", "headers", "8S:+", "\\u2560\\u2509\\u2567\\u2503\\u256c\\u251b", "\\u255e\\u2530\\u2543\\u2526\\u2554\\u2520\\u2562\\u2507\\u2561\\u250e\\u257c\\u2519", "a", 14, ":dB2", "href", "click", "err", 16, "hostname", "`60w", "\\f\x03b\x02\x0e\x07f", "\x1c&X "],\n        [";", "Element", Date, "par", "i", "DOMMous", 21, "xmT", "wserFe", "h", !0, 1, "", Boolean, \'\', "; domain=", "n 1970 00:", "cookie", "checkcookie", "allow", !1, "delCookie", 2333, "torage", ")*+,/\\\\\\\\:;", \'\', 0, \'\', "eliflmth", \'\', "ducument", RegExp, "W\x1e", "qsU", 61, 2, "sdelif_esab", "length", "I\x1c", "ff", 16, 45, "3", "10010", "77", 8, "6e%d", "DT{e", "\x1e$", / /g, ":", "href", 10, "location", "ned", "\\\\.com\\\\.cn$|\\\\.com\\\\.hk$", 63, "rea", "https://s.thsi.cn/js/chameleon/time.1", "tat", "loaded", "interactive", "WY:ZYS", "E?`a", "addEventListener", "eScroll", "onmousewheel", "mousemove", "\\u255e\\u096e\\u096e\\u09e3\\u09a5\\u092e\\u099a\\u09d4\\u0990", "\\u2550\\u2535\\u2541\\u250c\\u2563\\u2516\\u2565\\u2500\\u2543\\u252f\\u2546\\u2525\\u254e", "getKeyDown", "H69<J", "v~g\x1c-", "\x17\x16", "ature", "callPhantom", "ActiveXObject", "Uint8Array", "WeakMap", "JX%<\x1c", "chrome", "@L:!", "20", "language", "localStorage", "^Win32", String, 3, 4, "=\x1aXAE", "hea", "&", "/", "\\\\R$", \'^R"VP\', "s", "include", "_raw", "x.", "isRst", "SCRIPT", "ta", "base", "$?", "^_self$", "#", "unload", "ro", "\\u2550", "^(.*?):[ \\\\t]*([^\\\\r\\\\n]*)\\\\r?$", "g", "Init", "t6?x}", "\\u2574\\u0955\\u097b\\u09dc\\u0995\\u0911\\u09ab\\u09fe\\u09ba\\u09e2\\u098e\\u09fe\\u09f9\\u09f9\\u09f3\\u0a55", "=d\' "],\n        ["<=>?@[\\\\]^", "e", "HE9", "tot", "\\u2503", "0", "dyS", "se", "getRoot", "NR", "nd", 60, "ng", "s", "get", "mit", 13, 3, 0, "", \'\', "\\u255f\\u253a\\u255b\\u253f", "getCookie", "=", "length", "V587", 1, String, !0, "___", "\\u2553\\u2536\\u255a", "uBot", "base_fileds", 32, "2", "1", "20", 5, "255", 2, 8, 16, 10, "203", "base64Encode", "base64Decode", "decode", "760", "\\u255b\\u0978\\u0954\\u09f6\\u09a4\\u0935", 70, "location", "href", "redirect_url", "efi", Date, "\\u2519", "^\\\\s*(?:https?:)?\\\\/{2,}([^\\\\/\\\\?\\\\#\\\\\\\\]+)", "\\u255e", "[@:]", "@", 7, "onload", \'WY$PYS/FLV"P[_7[_R\', "readyState", "onreadystatechange", \'"\x1f^w\', "\\u2569\\u2535\\u2546\\u256c\\u2544\\u257b\\u2541\\u2569\\u2501\\u2575\\u2501\\u2571\\u2502\\u253d\\u2507\\u252e\\u2507\\u2538\\u2564\\u254b\\u2530\\u2502\\u252e\\u2553\\u257b\\u2520\\u257e\\u2522\\u250d\\u2551\\u256e\\u2532\\u2511\\u254d\\u2511\\u254c\\u2567\\u254e", "analysisRst", "strToBytes", "strhash", "random", "getHostFromUrl", "getOriginFromUrl", 83, "timeNow", "^(\\\\d+\\\\.)+\\\\d+$", "d", "v", "ted", "touchmove", 85, "F(K9i", "clientX", "clientY", "\\u257a\\u2515\\u256f\\u253c", "postMessage", \'\', "ActiveXObject", "Apple Computer, Inc.", "Q", "chr", "\\u2558\\u2535\\u2550", "BIDUBrowser", RegExp, "QQBrowser", "ro", "aef", "msDoNotTrack", "PDF|Acrobat", "canvas", "yE", "\\u255b\\u253a\\u2554\\u2533\\u2546\\u2527\\u2540\\u2525\\u2556", "^Android", "^Linux [ix]\\\\d+", "011", "13", 15, "sub", "addEventListener", "jsonp_ignore", "\\u2569", !1, \'L\x19"\', "Sj", "T{_,", "q*", "i", "tagName", "et", "{\'K", "Pp<", "#x\'", "open", "rS", "\x1fKN3", "#", "protocol", "\\\\.", "DEDAOL_NOELEMAHC"],\n        [83, "ffer", "\\u2505", "20", "e", "ngsE", Error, "est", "\\u2552\\u095b\\u0956\\u09f0\\u09a3\\u0935\\u09c0\\u09e2", "1", "sr", "hexin-v", "", RegExp, 9527, 0, "**l>\x17", "head", "Thu, 01 Ja", "00:00 GMT", "allow", "=", "; path=", "cookie", "Init", 33, 1, "setCookie", !0, "localS", "`{|}~]", "g", \'\', "frames", "___$&", 56, "\t\x07", "\\b\x07", "length", "10", "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_", "\\u2552\\u096f\\u0948\\u09fe\\u09a2", 16, 2, 6, "encode", "rea", "729", "*.", ",", "\\u2506\\u092c\\u090b\\u09a0\\u09e1\\u096d\\u09df\\u0981\\u09c4\\u098c", "redirect_url", "\\u2506\\u092d\\u090a\\u09a3", "1111101000", 3, 47, "tat", "script", "readyState", "complete", \'\', "body", "onwheel", "mousewheel", 37, "rus", "\\u2554\\u0975", "chr", "ActiveXObject", "WeakMap", "aT1Kg", "i", 24, "\\u2554\\u253c\\u254e\\u2521\\u254c\\u2529", "\\u2547\\u0971\\u094f\\u09f6\\u09b9\\u0933\\u099d", "Shockwav", "hockwave", "$cdc_asdjflasutopfhvcZLmcfl_", "webgl2", "2>n|", "plugins", "platform", "^Win64", "^Linux armv|Android", "^iPhone", "^MacIntel", !1, "getPlatform", "6Y,", 2333, "100", 12, "14", 10, 36, "01", "60", "\\u2542\\u096d\\u095e\\u09f0\\u09a4\\u0938", "\x1bj", 17, "Request", "prototype", "`z\x1a}lc\x06", "error", "s", "r", "target", "\\u255e", "A", "U", "193", "host", "$"],\n        ["se", "g@\x1ag?", Array, "*Y", Number, "^{.", "*}$", "und", "429", "496", "imeNow", "etti", "rg", "v", "hexin-v", Error, "L_%\\\\\x16T8", ".baidu.", 1, "", Function, !0, " ", \'\', 0, 2, "#default#userData", "ydob", "^d", 89, "11111111", 8, "epytotorp", 10, 16, "\\u2506\\u2536\\u2506\\u2536\\u2506", "14", 13, "10", "Syd", 44, "Domain", "serverT", \'^"\', "length", RegExp, "00", "tcejbo", "status_code", "n", 66, "\\u2506\\u2531\\u2504\\u2534", "htgnel", Date, "L%", 67, "5", "?)\'", \'\', "[[?VS", "isT", "getMouseWhell", "}}", "TR", "ActiveXObject", "WE", "python", "Maxthon", 97, "chrome", "Ryp", "UBrowser", 54, !1, "ontouchstart", "\\u254d\\u0975\\u0917\\u09f2\\u09be", "iso-8859-1", "defaultCharset", "^iPad", "getBrowserIndex", 256, "1", 5, "17", "Init", "XMLHttp", "tar", "allow", "@\x1a*\x16", "?\\\\", "?", "\\u2571\\u2503\\u256a\\u2546\\u2566\\u2556\\u2567\\u2547\\u2501\\u2564\\u2506\\u2526\\u2514\\u2524\\u2511\\u2521\\u2501\\u2531\\u2501\\u253b\\u250b\\u253b\\u2501\\u2531\\u2501\\u2521\\u2566\\u252b\\u257f", "den", "tia", 94, "ls", "\\u2554\\u2526\\u2543", "_str", 37, "append", "Child", "\\u255f", "\\u2569\\u0975\\u094e\\u09e5\\u09a0\\u092e\\u09d1\\u09ed\\u09ce", "srcElement", "parentNode", "\\u2543\\u2522\\u2545\\u250b\\u256a\\u2507\\u2562", "}*", "err", "or", "getAllResponseHeaders", "\\\\.?", "\\\\."]\n    );\n    return v\n}\n',
        encoding='utf-8'))


    def __init__(self):
        self.config={}
        self.headers={
            'Accept': 'application/json, text/plain, */*',
            'Accept-Encoding': 'gzip, deflate',
            'Accept-Language': 'zh-CN,zh;q=0.9',
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:90.0) Gecko/20100101 Firefox/90.0',
            'Cache-Control': 'no-cache',
            'Cookie':'other_uid=Ths_iwencai_Xuangu_ggtqtiw2csfamnr6z3w4bgdvely7nu15; ta_random_userid=imrochamo8; user_status=0; user=MDptb181MTk1NjI5OTM6Ok5vbmU6NTAwOjUyOTU2Mjk5Mzo3LDExMTExMTExMTExLDQwOzQ0LDExLDQwOzYsMSw0MDs1LDEsNDA7MSwxMDEsNDA7MiwxLDQwOzMsMSw0MDs1LDEsNDA7OCwwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMSw0MDsxMDIsMSw0MDoyNDo6OjUxOTU2Mjk5MzoxNjc1MzU1NzU2Ojo6MTU4Njc3NTEyMDo0MDEwNDQ6MDoxYTA4ZGYxYWExMGZmMmM0Yjc2YTRmYjQyZGMwMDRjY2U6ZGVmYXVsdF80OjE%3D; userid=519562993; u_name=mo_519562993; escapename=mo_519562993; ticket=e6e2970f200468790cc2beb6c225b985; utk=d4e0d6327ae995c19920064c342d6e4f; v=A1tbhsWpvDm6DMBN26SQ2VXT6rTAMG8yaUQz5k2YN9pxLHWq1QD_gnkUwz1e',
        }
        self.base_url='https://www.iwencai.com'
    async def request(self,method: Literal["GET", "POST", "PUT", "DELETE"], url: str,
                      params: Dict = None, body: Dict = None, headers: Dict = None) -> Any:
        self.headers.update(headers)
        async with aiohttp.request(method, f'{self.base_url}{url}', params=params, json=body,
                                   headers=self.headers) as resp:  # type: ignore

            return await resp.json()

    async def get(self, url: str, params: Dict = None, headers: Dict = None) -> Any:
        return await self.request("GET", url, params=params, headers=headers)

    async def post(self, url: str, body: Dict = None, headers: Dict = None) -> Any:
        return await self.request("POST", url, body=body, headers=headers)

    async def updateCookie(self,cookie):
        self.headers.update({'Cookie':cookie})
    async def updateBasicconfig(self,config):
        for key,value in config.items():
            self.config[key] = value

    async def GetUserInfo(self):
        """
        获取用户信息
        """

        try:
            url = '/gateway/crowdsource/user/info'
            ret=await self.get(url, headers={'hexin-v':self.wencaiJSCode.call('v')})

            if ret['status_msg'] == 'success':
                self.userid=ret['data']['userid']
                self.role=ret['data']['role']
                print('data:',ret)
                return ret['data']
        except Exception as e:
            print(32,str(e))

    async def getAnswer(self,question,querytype='stock',maxPage=100,delay=0):
        for page in range(maxPage):
            if delay>0:
                await asyncio.sleep(delay)
            url='/customized/chart/get-robot-data'
            data= {"question": question, "perpage": "100", "page": page + 1, "secondary_intent": querytype,
                               "log_info": "{\"input_type\":\"typewrite\"}", "iwcpro": 1,
                               "source": "Ths_iwencai_Xuangu",
                               "version": "2.0", "query_area": "", "block_list": "",
                               "add_info": r"{\"urp\":{\"scene\":1,\"company\":1,\"business\":1},\"contentType\":\"json\",\"searchInfo\":true}",
                               "rsh": self.userid}
            ret=await self.post(url,data,headers={'hexin-v':self.wencaiJSCode.call('v')})

            print('ret:',ret)



if __name__ == '__main__':
    from common.globalFunctions import cmdlineApp
    @cmdlineApp
    async def test(db):
        service=Service.wencaiService
        await service.GetUserInfo()
        question=[
            '行业;涨跌幅;周dea<=0;流通市值<300亿收盘价>60日线;20日线上移;60日线上移或60日线>昨日60日线;20均线/30均线>97%;周kd>38且上移周mamtm>0或日adxr连续8天上移;周mamtm上移或日adxr连续8天上移;日线dea>上一交易日dea或上一交易日dea上移周dea上移日macd>上一交易日macd或上一交易日macd上移周macd>0;周macd上移日diff>0>上一交易日diff或上一交易日diff上移;剔除亏损;日(mtm值)>上一交易日(mtm值)或上一交易日(mtm值)上移;剔除st;9:34前成交额>上一交易日成交额*16%或9:39前成交额>上一交易日成交额*28%或9:45前成交额>上一交易日成交额*36.5%或9:52前成交额>上一交易日成交额*44%或10:00前成交额>上一交易日成交额*50.5%;20周均线上移或日adxr连续8天上移;20周线/60周线<96.5%;日mamtm>0>上一交易日mamtm或上一交易日mamtm上移或日adxr连续8天上移;四天内J<K;日adxr连续8天上移;近10个交易日换手率>13%;']
        #question=['中国建筑当前股价']
        await service.getAnswer(question[0])
    test()




